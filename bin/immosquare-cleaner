#!/usr/bin/env ruby

# $LOAD_PATH.unshift(File.expand_path("../../lib", __FILE__))

require "immosquare-cleaner"
require "optparse"

options = {}

##===========================================================================##
## optparse is a standard library of ruby, it's used to parse command line   ##
##===========================================================================##
OptionParser.new do |opts|
  opts.banner = "Usage: immosquare-cleaner [options] file"

  ##===========================================================================##
  ## Capture all single-letter options (like '-t', '-a', etc.)                 ##
  ##===========================================================================##
  ('a'..'z').each do |letter|
    opts.on("-#{letter} [OPTION]", "Option -#{letter}") do |value|
      options[letter.to_sym] = value
    end
  end

  ##===========================================================================##
  ## If you also want to capture longer options, add them here                 ##
  ## Example:                                                                  ##
  ## opts.on("--tag TAG", "Tag option") do |t|                                 ##
  ##   options[:tag] = t                                                       ##
  ## end                                                                       ##
  ##===========================================================================##
end.parse!

##===========================================================================##
## Check if the file path is provided                                         ##
##===========================================================================##
file_path = ARGV[0]
if !file_path
  $stderr.puts("Error: Please provide a file path.")
  exit 1
end

##===========================================================================##
## Check if the file exists                                                   ##
##===========================================================================##
if !File.exist?(file_path)
  $stderr.puts("Error: The file '#{file_path}' does not exist.")
  exit 1
end

File.open("/Users/jules/Desktop/toto.txt", "a") do |f|
  f.puts("Let's clean #{file_path}...")
end

$stderr.puts("Let's clean #{file_path}...")

ImmosquareCleaner.clean(file_path, options)
